Проблема: Автоматически рассчитывать скидку для покупателя на основе суммы покупок за квартал.
______________________________________________________________________________________________

// В модуле документа "Реализация"
&НаСервере
Функция РассчитатьСкидку(Контрагент)
    НачалоПериода = НачалоКвартала(ТекущаяДата());
    КонецПериода = КонецКвартала(ТекущаяДата());
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   СУММА(Реализация.СуммаДокумента) КАК СуммаПокупок
        |ИЗ
        |   Документ.РеализацияТоваровУслуг КАК Реализация
        |ГДЕ
        |   Реализация.Контрагент = &Контрагент
        |   И Реализация.Дата МЕЖДУ &Начало И &Конец
        |   И Реализация.Проведен";
    
    Запрос.УстановитьПараметр("Контрагент", Контрагент);
    Запрос.УстановитьПараметр("Начало", НачалоПериода);
    Запрос.УстановитьПараметр("Конец", КонецПериода);
    
    Результат = Запрос.Выполнить().Выбрать();
    Если Результат.Следующий() Тогда
        СуммаПокупок = Результат.СуммаПокупок;
        
        Возврат ?(СуммаПокупок > 100000, 0.15, 
                ?(СуммаПокупок > 50000, 0.10, 
                ?(СуммаПокупок > 20000, 0.05, 0)))
    КонецЕсли;
    
    Возврат 0;
КонецФункции
